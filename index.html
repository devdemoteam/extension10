<!DOCTYPE html>
<html>
<head>
    <title>WebHID Headset Report</title>
    <style>
        body {
            font-family: sans-serif;
            line-height: 1.6;
            padding: 20px;
            max-width: 800px;
            margin: auto;
            background-color: #f4f4f4;
        }
        h1 {
            color: #333;
        }
        button {
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #007BFF;
            color: white;
            margin-right: 10px;
            transition: background-color 0.3s;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        button:hover:not(:disabled) {
            background-color: #0056b3;
        }
        pre {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 15px;
            white-space: pre-wrap;
            word-wrap: break-word;
            min-height: 100px;
            max-height: 400px;
            overflow-y: auto;
        }
        #download-link {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <h1>WebHID Headset Event Capturer</h1>
    <p>
        Connect your headset, and this page will listen for events. When you click connect, the browser will show a list of all available HID devices.
    </p>

    <button id="connect-headset">Connect to Headset</button>
    <button id="generate-report" disabled>Generate and Download Report</button>
    
    <h3>Live Event Log:</h3>
    <pre id="output">Not connected. Click the button to connect to a HID device.</pre>
    
    <a id="download-link" style="display:none"></a>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const connectButton = document.getElementById('connect-headset');
            const reportButton = document.getElementById('generate-report');
            const output = document.getElementById('output');
            const downloadLink = document.getElementById('download-link');

            let capturedEvents = [];
            let device = null;

            connectButton.addEventListener('click', async () => {
                try {
                    // **FIXED LINE HERE**
                    // We now pass an empty filters array, which tells the browser to let the user pick from any connected HID device.
                    const devices = await navigator.hid.requestDevice({
                        filters: []
                    });

                    device = devices[0];
                    if (!device) {
                        output.textContent = 'No device selected.';
                        return;
                    }

                    await device.open();
                    output.textContent = `Connected to: ${device.productName}. Listening for events...\n`;
                    reportButton.disabled = false;
                    connectButton.disabled = true;
                    connectButton.textContent = 'Connected';

                    // Listen for input reports from the headset
                    device.addEventListener('inputreport', event => {
                        const { data, device, reportId } = event;
                        const eventData = {
                            timestamp: new Date().toISOString(),
                            reportId: reportId,
                            data: Array.from(new Uint8Array(data.buffer))
                        };
                        capturedEvents.push(eventData);

                        // Display the raw data
                        output.textContent += `\n[${eventData.timestamp}] Report ID: ${reportId}, Data: [${eventData.data.join(', ')}]`;
                        // Auto-scroll to the bottom
                        output.scrollTop = output.scrollHeight; 
                    });

                } catch (error) {
                    output.textContent = `Error: ${error.message}`;
                    console.error(error);
                }
            });

            reportButton.addEventListener('click', () => {
                if (capturedEvents.length === 0) {
                    alert('No events ha
